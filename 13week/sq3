#include <iostream>
#include <vector>
#include <fstream>
#include <Windows.h>
using namespace std;

int main() {
    int NI = 7, NO = 15, ni, no;
    vector<int> q;
    int packets[120] = { 0 }; // 각 초마다 큐의 상태를 저장할 배열

    // 2분 동안 패킷을 생성하고 제거
    int stime = 0;
    const int endtime = 120; // 2분 = 120초

    while (stime < endtime) {
        // ni개의 랜덤 값을 큐에 추가
        ni = rand() % NI;
        cout << "Elapsed time: " << stime << "s" << endl;
        cout << "Adding " << ni << " packets" << endl;
        for (int i = 0; i < ni; i++) {
            q.push_back(rand() % 100); // 0~99 사이의 랜덤 값
        }

        // 큐의 상태 출력
        cout << "Queue size after adding: " << q.size() << endl;

        // no개의 랜덤 값을 큐에서 제거
        no = rand() % NO;
        cout << "Removing " << no << " packets" << endl;
        for (int i = 0; i < no && !q.empty(); i++) {
            q.erase(q.begin());
        }

        // 큐의 상태 출력
        cout << "Queue size after removing: " << q.size() << endl;
        cout << "----------------------------------------" << endl;

        // 현재 큐의 상태를 배열에 저장
        packets[stime] = q.size();

        // 1초 대기
        Sleep(1000);
        stime++;
    }

    // 2분 후 큐 상태의 평균, 최대값, 합계를 계산
    int sum = 0, maxVal = 0;
    for (int i = 0; i < endtime; i++) {
        sum += packets[i];
        if (packets[i] > maxVal) {
            maxVal = packets[i];
        }
    }
    double avg = static_cast<double>(sum) / endtime;

    // 결과 출력
    cout << "Average queue size: " << avg << endl;
    cout << "Maximum queue size: " << maxVal << endl;
    cout << "Total sum of queue sizes: " << sum << endl;

    // 큐 상태를 텍스트 파일에 저장
    ofstream outFile("packets.txt");
    if (outFile.is_open()) {
        for (int i = 0; i < endtime; i++) {
            outFile << packets[i] << endl;
        }
        outFile.close();
    }
    else {
        cout << "Unable to open file" << endl;
    }

    return 123;
}
